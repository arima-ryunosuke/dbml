<!DOCTYPE html>
<html>
<head>	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/foundation.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js-bootstrap-css/1.2.1/typeaheadjs.min.css">
	<link rel="stylesheet" type="text/css" data-href="common.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/3.1.1/bootstrap3-typeahead.min.js"></script>
	<script data-src="common.js"></script>

	<script>
        (function () {
            var cachekey;
            try {
                cachekey = window.parent.CACHEKEY;
            }
            catch (e) {
                cachekey = 'nocache';
            }
            $('link[data-href]').attr('href', function () {
                return this.dataset.href + '?' + cachekey;
            });
            $('script[data-src]').attr('src', function () {
                return this.dataset.src + '?' + cachekey;
            });

            $(document).on('click', 'a[href]:not([target="_blank"]):not(.cachekey)', function () {
                this.classList.add('cachekey');
                this.href = this.href.replace('.html', '.html?' + cachekey);
            });
        })();
	</script>
    </head>
<body class="typespace">
<a id="anchor" href="./" style="display: none"></a>
<h1 class="ellipsis fixed">
	<span class="pull-left">
	Structure
	<small class="ellipsis-text">(ryunosuke\dbml\Query\Expression\PhpExpression)</small>
	</span>
	<span class="pull-right">
		<small class="frame-switch">
		<a target="_parent">frame</a> | <a target="_parent">noframe</a>
		</small>
	</span>
</h1>
<div class="main-wrapper">
	<div class="attribute">
		<span class="label label-danger"></span>
		<span class="label label-warning"></span>
		<span class="label label-info"></span>
		<span class="label label-info"></span>
		<span class="label label-deprecated"></span>
        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L10-L301" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                    	</div>

	<h2>class <span class="category-name">ryunosuke\dbml\Query\Expression\PhpExpression</span></h2>

	<div class="description"><p>php の式を表すクラス</p>
<p>このクラスのインスタンスを select に組み込むとアプリケーションレイヤで値を返すようになる。<br />
応用的に「カラムAとカラムBを結合してカラムXを作り出す」という処理を透過的に行うことができる。</p>
<pre><code class="language-php"># シンプルなスカラー値の例
$db-&gt;selectTuple([
    'tablename' =&gt; [
        'nullvalue' =&gt; new PhpExpression(null),
        'boolvalue' =&gt; new PhpExpression(true),
        'strbalue'  =&gt; new PhpExpression('mojiretu'),
    ],
]);
// results:
[
    // PhpExpression に与えた null がそのまま結果配列に含まれてくる
    'nullvalue' =&gt; null,
    // PhpExpression に与えた true がそのまま結果配列に含まれてくる
    'boolvalue' =&gt; true,
    // PhpExpression に与えた 'mojiretu' がそのまま結果配列に含まれてくる
    'strbalue'  =&gt; 'mojiretu',
];

# 上記の例は冗長な上にほとんど旨味がない。似たようなことは Expression の自動変換で代替可能（ただの文字列だけは無理）
$db-&gt;selectTuple([
    'tablename' =&gt; [
        'nullvalue' =&gt; "NULL",
        'boolvalue' =&gt; true,
    ],
]);
// results:
[
    'nullvalue' =&gt; null,
    'boolvalue' =&gt; true,
];
</code></pre>
<p>ただし、上記にような使い方はただの副産物であり、本来はクロージャを渡すことを想定している。</p>
<pre><code class="language-php"># 最も有用な使い方はクロージャを与えた時（有用と言うか、クロージャのために存在していると言っても過言ではない）
$db-&gt;selectTuple([
    'tablename' =&gt; [
        // カラムa, カラムb を自動で取得し、その加算結果を列として取得する（第2引数以降で取得するカラムを指定する）
        'a+b' =&gt; new PhpExpression(function ($a, $b) { return $a + $b; }, 'a', 'b'),
        // なお、クロージャは自動で PhpExpression に変換されるのでこれでも同じ（引数のデフォルト値で取得するカラムを指定する）
        'a*b' =&gt; function ($a = 'a', $b = 'b') { return $a * $b; },
        // 素のクロージャで引数のデフォルト値がない場合、行全体が引数として渡ってくる
        'a-b' =&gt; function ($row) { return $row['a'] - $row['b']; },
        // 素のクロージャで引数のデフォルト値が null の場合、キーをカラム名として使用する
        'a'   =&gt; function ($id = null) { $id * 10; },
    ],
]);
// results:
[
    // 仮に、a:4 b:2 だとしたら下記が結果配列に含まれてくる
    'a+b' =&gt; 6,
    'a*b' =&gt; 8,
    'a-b' =&gt; 2,
    'a'   =&gt; 40,
];
</code></pre>
<p>上記の最後の「引数のデフォルト値が null」について補足すると、この形式は動的な部分が一切ない。つまりただの関数として持ち回すことができる。<br />
よくありそうな処理は組み込みで用意してあるが、 define を使用して登録することもできる。</p>
<pre><code class="language-php"># もち回せる関数の登録と組み込み処理の例
// まず append という名前で処理を登録する
PhpExpression::define('append', function ($column, ...$appendix) {
    return $column . '-' . implode('', $appendix);
});
// 組み込みと登録した append を使用する例
$db-&gt;selectTuple([
    'tablename' =&gt; [
        // PhpExpression::explode は「指定文字列で explode するクロージャ」を返すので、こうするだけでカラム a をカンマでバラすことができる
        'a' =&gt; PhpExpression::explode(','),
        // 上記で登録した append を使う（使い方自体は変わらない）
        'b' =&gt; PhpExpression::append('X', 'Y', 'Z'),
    ],
]);
// results:
[
    // 仮に、a:"x,y,z" b:"hogestring" だとしたら下記が結果配列に含まれてくる
    'a' =&gt; ['x', 'y', 'z'], // カンマでバラされている
    'b' =&gt; 'hogestring-XYZ', // 与えた引数 XYZ が付与されている
];
</code></pre>
<p>ただし、実際のところすごく難解でかつニッチなので、実際のところ</p>
<ul>
<li><code>function ($row) {}</code> 小細工せずに行をまるごと返す形式</li>
<li><code>function ($id = 'id') {}</code> デフォルト値でカラムを指定する形式<br />
程度しか使われないしこれさえ覚えておけば困らない（その場にクロージャで書かれていた方が何をしているか分かりやすい、というメリットもある）。</li>
</ul>
</div>

	<h3>Construction</h3>
                
	<h3>Hierarchy</h3>
	<div class="hierarchy"></div>

	<h3>Constants</h3>
    
	<h3>Properties</h3>
    
	<h3>Methods</h3>
    		<ul>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L130-L139" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::define()" tabindex="-1" class="structure-title ">
                        define						<small>($name, $callback)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>クロージャを定義する</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$name</td>
				<td class="desc"><p>定義名</p>
</td>
			</tr>
        			<tr>
				<td class="type">callable<span class="type-separator"></span><wbr>null</td>
				<td class="rest">$callback</td>
				<td class="desc"><p>処理実体</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">void</td>
			<td class="desc"></td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L141-L173" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::forge()" tabindex="-1" class="structure-title ">
                        forge						<small>($expr, $key = null)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>値を PhpExpression 化して返す</p>
<p>変換できなそうならそのまま返す。</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">mixed</td>
				<td class="rest">$expr</td>
				<td class="desc"><p>値</p>
</td>
			</tr>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$key = null</td>
				<td class="desc"><p>元キー</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="ryunosuke-dbml-Query-Expression-PhpExpression$typespace.html#ryunosuke\dbml\Query\Expression\PhpExpression" class="fqsen "><small>ryunosuke\dbml\Query\Expression\</small><wbr>PhpExpression</a><span class="type-separator"></span><wbr>mixed</td>
			<td class="desc"><p>PhpExpression インスタンス</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L175-L211" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::__callStatic()" tabindex="-1" class="structure-title ">
                        __callStatic						<small>($name, $arguments)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>単一引数のシンプルなクロージャを返す</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">string</td>
				<td class="rest">$name</td>
				<td class="desc"><p>定義名</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">$arguments</td>
				<td class="desc"><p>クロージャに与える引数配列</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="http://php.net/manual/ja/class.closure.php" class="fqsen" target="_blank">\Closure</a></td>
			<td class="desc"><p>クロージャ</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L213-L244" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::__construct()" tabindex="-1" class="structure-title ">
                        __construct						<small>($expr, ...$depends)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>コンストラクタ</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">mixed</td>
				<td class="rest">$expr</td>
				<td class="desc"><p>php 式</p>
</td>
			</tr>
        			<tr>
				<td class="type">array</td>
				<td class="rest">...$depends</td>
				<td class="desc"><p>依存カラム</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">void</td>
			<td class="desc"></td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L246-L287" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::__invoke()" tabindex="-1" class="structure-title ">
                        __invoke						<small>($row)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>式の結果を返す</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">mixed</td>
				<td class="rest">$row</td>
				<td class="desc"><p>自身の行</p>
</td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type">mixed</td>
			<td class="desc"><p>保持してる表現。クロージャならそのコール結果</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-magic"></span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L289-L300" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::getDependColumns()" tabindex="-1" class="structure-title ">
                        getDependColumns						<small>()</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>依存カラムを返す</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="ryunosuke-dbml-Query-Expression-Alias$typespace.html#ryunosuke\dbml\Query\Expression\Alias" class="fqsen "><small>ryunosuke\dbml\Query\Expression\</small><wbr>Alias</a>[]</td>
			<td class="desc"><p>自身が依存しているカラム配列</p>
</td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic">magic</span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L106-L106" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::explode()" tabindex="-1" class="structure-title ">
                        explode						<small>($delimiter)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>指定文字列でバラすクロージャを返す</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">mixed</td>
				<td class="rest">$delimiter</td>
				<td class="desc"></td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="http://php.net/manual/ja/class.closure.php" class="fqsen" target="_blank">\Closure</a></td>
			<td class="desc"></td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic">magic</span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L107-L107" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::sprintf()" tabindex="-1" class="structure-title ">
                        sprintf						<small>($format)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>指定書式文字列でフォーマットするクロージャを返す</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">mixed</td>
				<td class="rest">$format</td>
				<td class="desc"></td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="http://php.net/manual/ja/class.closure.php" class="fqsen" target="_blank">\Closure</a></td>
			<td class="desc"></td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            				<li class="structure-item">
					<div class="attribute">
						<span class="label label-danger"></span>
						<span class="label label-default">static</span>
						<span class="label label-magic">magic</span>
						<span class="label label-danger"></span>
						<span class="label label-default"></span>
						<span class="label label-default"></span>
						<span class="label label-deprecated"></span>
						<span class="label label-public">public</span>
                        			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L108-L108" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
                                    					</div>
					<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression::date()" tabindex="-1" class="structure-title ">
                        date						<small>($format)</small>
					</h4>
					<div class="inner-item">
						<div class="description"><p>指定フォーマットで日付文字列化するクロージャを返す</p>
</div>
                        	<table class="table">
		<caption>Parameters</caption>
		<tbody>
        			<tr>
				<td class="type">mixed</td>
				<td class="rest">$format</td>
				<td class="desc"></td>
			</tr>
        		</tbody>
	</table>
                            	<table class="table">
		<caption>Return</caption>
		<tbody>
		<tr>
			<td class="type"><a href="http://php.net/manual/ja/class.closure.php" class="fqsen" target="_blank">\Closure</a></td>
			<td class="desc"></td>
			<td class="rest"></td>
		</tr>
		</tbody>
	</table>
                                                                            					</div>
					<div class="attribute">
						<span class="label label-default"></span>
						<span class="label label-default"></span>
					</div>
					<div class="clearfix"></div>
				</li>
            		</ul>
    
	<div class="attribute">
		<span class="label label-default"></span>
		<span class="label label-default"></span>
	</div>
	<div class="clearfix"></div>
</div>
</body>
</html>
