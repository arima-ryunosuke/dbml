<!DOCTYPE html>
<html>
<head>	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/zenburn.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js-bootstrap-css/1.2.1/typeaheadjs.min.css">
	<link rel="stylesheet" type="text/css" data-href="common.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/3.1.1/bootstrap3-typeahead.min.js"></script>
	<script data-src="common.js"></script>

	<script>
        (function () {
            var cachekey;
            try {
                cachekey = window.parent.CACHEKEY;
            }
            catch (e) {
                cachekey = 'nocache';
            }
            $('link[data-href]').attr('href', function () {
                return this.dataset.href + '?' + cachekey;
            });
            $('script[data-src]').attr('src', function () {
                return this.dataset.src + '?' + cachekey;
            });

            $(document).on('click', 'a[href]:not([target="_blank"]):not(.cachekey)', function () {
                this.classList.add('cachekey');
                this.href = this.href.replace('.html', '.html?' + cachekey);
            });
        })();
	</script>
    </head>
<body>
<a id="anchor" href="./" style="display: none"></a>
<h1 class="ellipsis">
	Structure
	<small class="ellipsis-text">(ryunosuke\dbml\Query\Expression\)</small>
	<span class="pull-right">
		<small class="frame-switch">
		<a target="_parent">frame</a> | <a target="_parent">noframe</a>
		</small>
	</span>
</h1>
<div class="main-wrapper">
	<h2>namespace <span class="category-name">ryunosuke\dbml\Query\Expression\</span></h2>
	<div class="inner-item">
		<div class="description"></div>
	</div>

    
                                    			<h3>Classes</h3>
			<ul>
                					<li class="structure-item">
						<div class="attribute">
							<span class="label label-danger"></span>
							<span class="label label-warning"></span>
							<span class="label label-info"></span>
							<span class="label label-info"></span>
							<span class="label label-deprecated"></span>
                            			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/TableDescriptor.php#L19-L566" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            						</div>
						<h4 id="ryunosuke\dbml\Query\Expression\TableDescriptor" tabindex="-1" class="structure-title ">
							<a href="ryunosuke-dbml-Query-Expression-TableDescriptor$typespace.html#ryunosuke\dbml\Query\Expression\TableDescriptor">TableDescriptor</a>
						</h4>
						<div class="inner-item">
							<div class="description"><p>テーブル記法の実装クラス</p>
<p>テーブル記法の概念については <tag_link data-kind='fqsen' data-type-category='type' data-type-fqsen='ryunosuke\dbml\' data-type-array='0' data-description='dbml'>dbml</tag_link> を参照。<br />
なお、内部的に使用されるだけで能動的に new したり活用されたりするようなクラスではない。</p>
<p>下記に記法としての定義を記載する。組み合わせた場合の使用例は <tag_link data-kind='fqsen' data-type-category='method' data-type-fqsen='ryunosuke\dbml\Query\QueryBuilder::column()' data-type-array='0' data-description='QueryBuilder::column()'>QueryBuilder::column()</tag_link> を参照。</p>
<p><code>'(joinsign)tablename(pkval)@scope:fkeyname[condition]+order-by#offset-limit AS Alias.col1, col2 AS C2'</code></p>
<table>
<thead>
<tr><th align="left">要素</th><th align="center">必須</th><th align="left">説明</th></tr>
</thead>
<tbody>
<tr><td align="left">joinsign</td><td align="center">任意</td><td align="left">JOIN する場合に結合方法を表す記号を置く（'*':CROSS, '+':INNER, '&lt;':LEFT, '&gt;':RIGHT, '~':AUTO, ',':FROM）</td></tr>
<tr><td align="left">tablename</td><td align="center">必須</td><td align="left">取得するテーブル名を指定する</td></tr>
<tr><td align="left">(pkval)</td><td align="center">任意</td><td align="left">主キーの値を指定する</td></tr>
<tr><td align="left">@scope</td><td align="center">任意</td><td align="left">対応する Gateway がありかつ <code>scope</code> というスコープが定義されているならそのスコープを当てる（複数可）</td></tr>
<tr><td align="left">:fkeyname</td><td align="center">任意</td><td align="left">JOIN に使用する外部キー名を指定する</td></tr>
<tr><td align="left">[condition]</td><td align="center">任意</td><td align="left">絞り込み条件を yaml で指定する（where 記法）</td></tr>
<tr><td align="left">{condition}</td><td align="center">任意</td><td align="left">絞り込み条件を yaml で指定する（カラム結合）</td></tr>
<tr><td align="left">+order-by</td><td align="center">任意</td><td align="left">ORDER BY を指定する</td></tr>
<tr><td align="left">#offset-limit</td><td align="center">任意</td><td align="left">LIMIT, OFFSET を指定する</td></tr>
<tr><td align="left">AS Alias</td><td align="center">任意</td><td align="left">テーブルエイリアスを指定する</td></tr>
<tr><td align="left">.col1, col2 AS C2</td><td align="center">任意</td><td align="left">取得するカラムを指定する</td></tr>
</tbody>
</table>
<h4>joinsign</h4>
<p>テーブルのプレフィックスとして <code>*+&lt;&gt;~,</code> を付けて JOIN を表す。<br />
他に特記事項はない。</p>
<h4>tablename</h4>
<p>テーブル名を表す。<br />
他に特記事項はない。</p>
<h4>(pkval)</h4>
<p>"()" 内で主キーの値を指定する。WHERE IN 化される。<br />
主キーはカンマ区切りで複数指定できる。また、 "()" をネストすることで行値式相当の動作になる。</p>
<ul>
<li>e.g. <code>tablename(1)</code> （<code>WHERE pid IN (1)</code> となる）</li>
<li>e.g. <code>tablename(1, 2)</code> （<code>WHERE pid IN (1, 2)</code> となる）</li>
<li>e.g. <code>tablename((1, 2), (3, 4))</code> （<code>WHERE (mainid = 1 AND subid = 2) OR (mainid = 3 AND subid = 4)</code> となる）</li>
</ul>
<p>※ 行値式は対応していない RDBMS やインデックスが使われない RDBMS が存在するため一律 AND OR で構築される</p>
<h4>@scope</h4>
<p>テーブルのサフィックスとして <code>@</code> を付けてスコープを表す。<br />
関連するゲートウェイクラスが存在しかつ指定されたスコープが定義されていなければならない。</p>
<p><code>@</code>を連続することで複数のスコープを当てることができる。</p>
<ul>
<li>e.g. <code>tablename@scope1@scope2</code> （scope1 と scope2 を当てる）</li>
</ul>
<p><code>@</code> だけを付けるとデフォルトスコープを表す（あくまでゲートウェイとは別概念なのでデフォルトスコープと言えど明示的に与えなければならない）。</p>
<ul>
<li>e.g. <code>tablename@</code> （デフォルトスコープを当てる）</li>
<li>e.g. <code>tablename@@scope</code> （デフォルトスコープと scope スコープを当てる）</li>
</ul>
<p><code>@scope(1, 2)</code> とすることでパラメータ付きスコープの引数になる。</p>
<ul>
<li>e.g. <code>tablename@latest(5)</code> （最新5件のようなスコープ）</li>
</ul>
<h4>:fkeyname</h4>
<p>テーブルのサフィックスとして <code>:</code> を付けて外部キーを表す。<br />
テーブル間外部キーが1つなら指定しなくても自動で使用される。<br />
ただし、空文字を指定すると「外部キーを使用しない」を表す。</p>
<ul>
<li>e.g. <code>tablename:fkname</code> （結合条件として外部キーカラムが使用される）</li>
<li>e.g. <code>tablename</code> （同じ。テーブル間外部キーが1つならそれが指定されたとみなされる）</li>
<li>e.g. <code>tablename:</code> （外部キー結合なし）</li>
</ul>
<h4>[condition]</h4>
<p>テーブルのサフィックスとして yaml 記法で絞り込み条件を表す。<br />
駆動表に設定されている場合はただの WHERE 条件として働く。<br />
結合表に設定されている場合は ON 条件として働く。</p>
<ul>
<li>e.g. <code>tablename[id: 1, delete_flg = 0]</code> （<code>id = 1 AND delete_flg = 0</code> となる（where 記法と同じ））</li>
</ul>
<h4>{condition}</h4>
<p>テーブルのサフィックスとして yaml 記法で絞り込み条件を表す。</p>
<ul>
<li>e.g. <code>tablename{selfid: otherid}</code> （<code>selfid = otherid</code> となる（カラムで結合する））</li>
</ul>
<h4>+order-by</h4>
<p>テーブルのサフィックスとして [+-]columnname で ORDER BY を表す。<br />
"+" プレフィックスで昇順、 "-" プレフィックスで降順を表す。各指定の明確な区切りはない（≒[+-] のどちらかは必須）。</p>
<ul>
<li>e.g. <code>tablename+id</code> （<code>ORDER BY id ASC</code> となる）</li>
<li>e.g. <code>tablename-create_date+id</code> （<code>ORDER BY create_date DESC, id ASC</code> となる）</li>
</ul>
<h4>offset-limit</h4>
<p>テーブルのサフィックスとして #M-N で取得件数を表す。 M は省略可能。<br />
単純な LIMIT OFFSET ではない。言うなれば「範囲指定」のようなもので、例えば "#40-50" は LIMIT 10 OFFSET 40 を表す。<br />
つまり、「40件目から50-1件目」を表す（M はそのまま OFFSET に、 N - M が LIMIT になる）。<br />
さらに、-N を省略した場合は「LIMIT 1 OFFSET M」を意味する。つまり単純な1行を指すことになる。<br />
さらにさらに、M を省略した場合は 0 が補填される。クエリ的には OFFSET が設定されないことになる。<br />
さらにさらにさらにこの指定は<strong>駆動表にのみ設定される</strong>（JOIN の LIMIT はサブクエリになり効率的ではないし、そもそも利用頻度が少ない）。</p>
<ul>
<li>e.g. <code>tablename#150-200</code> （<code>LIMIT 50 OFFSET 150</code> となり範囲を表す）</li>
<li>e.g. <code>tablename#100</code> （<code>LIMIT 1 OFFSET 100</code> となり単一の1行を表す）</li>
<li>e.g. <code>tablename#-100</code> （`LIMIT 100 となる（M を省略した場合、 OFFSET は設定されない））</li>
</ul>
<h4>AS Alias</h4>
<p>テーブルにエイリアスをつける。<br />
<code>AS</code> は省略して <code>tablename T</code> でも良い</p>
<h4>.col1, col2 AS C2</h4>
<p>取得するカラムリストを表す。カラムは直近のテーブル（エイリアス）で修飾される。<br />
カンマ区切りで複数指定可能。<br />
各カラムに対して <code>AS aliasname</code> とすることでエイリアスを表す（AS は省略可能）。</p>
<ul>
<li>e.g. <code>tablename.colA</code> （colA を取得）</li>
<li>e.g. <code>tablename.colA, colB CB</code> （colA, colB（エイリアス CB） を取得）</li>
</ul>
<hr />
<p>+order-by と #offset-limit は下記のように非常に相性が良い。</p>
<ul>
<li><code>tablename-create_date#0</code> （作成日降順で1件取得）</li>
</ul>
<p>(pkval), @scope, :fkeyname, [condition], +order-by, #offset-limit に順番の規則はないので任意に入れ替えることができる。<br />
つまり、下記はすべて同じ意味となる（全組み合わせはとんでもない数になるので一部（:fkeyname, [condition] など）のみ列挙）。</p>
<ul>
<li><code>tablename@scope:fkeyname[condition]</code></li>
<li><code>tablename@scope[condition]:fkeyname</code></li>
<li><code>tablename:fkeyname@scope[condition]</code></li>
<li><code>tablename:fkeyname[condition]@scope</code></li>
<li><code>tablename[condition]@scope:fkeyname</code></li>
<li><code>tablename[condition]:fkeyname@scope</code></li>
</ul>
<p>ただし、 @scope(スコープ引数) と (pkval) の記法が重複しているため注意。<br />
例えば <code>@scope(1, 2)</code> これは「引数つきスコープ」なのか「引数なしスコープの後に (pkval)が来ている」のか区別ができない。<br />
見た目的な意味（あたかも関数コールのように見えて美しい）でも (pkval) はテーブル名の直後に置くのが望ましい。</p>
<p>また、 yaml の中にまでは言及しないため、 "#" や "@" 等がリテラル内にある場合は誤作動を引き起こす。<br />
構文解析までするのは仰々しいため、仕方のない仕様として許容する。</p>
<p>なお、<strong>テーブル記法に決してユーザ入力を埋め込んではならない</strong>。<br />
(pkval) などは埋め込みたくなるが、テーブル記法は値のエスケープなどを一切行わないので致命的な脆弱性となりうる。</p>
</div>
						</div>
						<div class="attribute">
							<span class="label label-default"></span>
							<span class="label label-default"></span>
						</div>
						<div class="clearfix"></div>
					</li>
                					<li class="structure-item">
						<div class="attribute">
							<span class="label label-danger"></span>
							<span class="label label-warning"></span>
							<span class="label label-info"></span>
							<span class="label label-info"></span>
							<span class="label label-deprecated"></span>
                            			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/Alias.php#L7-L127" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            						</div>
						<h4 id="ryunosuke\dbml\Query\Expression\Alias" tabindex="-1" class="structure-title ">
							<a href="ryunosuke-dbml-Query-Expression-Alias$typespace.html#ryunosuke\dbml\Query\Expression\Alias">Alias</a>
						</h4>
						<div class="inner-item">
							<div class="description"><p>カラムエイリアスを表すクラス</p>
<p><code>new Alias('alias', 'actual')</code> を select に与えると "actual AS alias" に展開される。</p>
</div>
						</div>
						<div class="attribute">
							<span class="label label-default"></span>
							<span class="label label-default"></span>
						</div>
						<div class="clearfix"></div>
					</li>
                					<li class="structure-item">
						<div class="attribute">
							<span class="label label-danger"></span>
							<span class="label label-warning"></span>
							<span class="label label-info"></span>
							<span class="label label-info"></span>
							<span class="label label-deprecated"></span>
                            			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/Expression.php#L8-L161" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            						</div>
						<h4 id="ryunosuke\dbml\Query\Expression\Expression" tabindex="-1" class="structure-title ">
							<a href="ryunosuke-dbml-Query-Expression-Expression$typespace.html#ryunosuke\dbml\Query\Expression\Expression">Expression</a>
						</h4>
						<div class="inner-item">
							<div class="description"><p>生クエリを表すクラス</p>
<p><code>new Expression('NOW()')</code> を select に与えると "NOW()" に展開される（エスケープやサブクエリ化などの余計なことを一切行わない）。</p>
</div>
						</div>
						<div class="attribute">
							<span class="label label-default"></span>
							<span class="label label-default"></span>
						</div>
						<div class="clearfix"></div>
					</li>
                					<li class="structure-item">
						<div class="attribute">
							<span class="label label-danger"></span>
							<span class="label label-warning"></span>
							<span class="label label-info"></span>
							<span class="label label-info"></span>
							<span class="label label-deprecated"></span>
                            			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/PhpExpression.php#L10-L301" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            						</div>
						<h4 id="ryunosuke\dbml\Query\Expression\PhpExpression" tabindex="-1" class="structure-title ">
							<a href="ryunosuke-dbml-Query-Expression-PhpExpression$typespace.html#ryunosuke\dbml\Query\Expression\PhpExpression">PhpExpression</a>
						</h4>
						<div class="inner-item">
							<div class="description"><p>php の式を表すクラス</p>
<p>このクラスのインスタンスを select に組み込むとアプリケーションレイヤで値を返すようになる。<br />
応用的に「カラムAとカラムBを結合してカラムXを作り出す」という処理を透過的に行うことができる。</p>
<pre><code class="language-php"># シンプルなスカラー値の例
$db-&gt;selectTuple([
    'tablename' =&gt; [
        'nullvalue' =&gt; new PhpExpression(null),
        'boolvalue' =&gt; new PhpExpression(true),
        'strbalue'  =&gt; new PhpExpression('mojiretu'),
    ],
]);
// results:
[
    // PhpExpression に与えた null がそのまま結果配列に含まれてくる
    'nullvalue' =&gt; null,
    // PhpExpression に与えた true がそのまま結果配列に含まれてくる
    'boolvalue' =&gt; true,
    // PhpExpression に与えた 'mojiretu' がそのまま結果配列に含まれてくる
    'strbalue'  =&gt; 'mojiretu',
];

# 上記の例は冗長な上にほとんど旨味がない。似たようなことは Expression の自動変換で代替可能（ただの文字列だけは無理）
$db-&gt;selectTuple([
    'tablename' =&gt; [
        'nullvalue' =&gt; "NULL",
        'boolvalue' =&gt; true,
    ],
]);
// results:
[
    'nullvalue' =&gt; null,
    'boolvalue' =&gt; true,
];
</code></pre>
<p>ただし、上記にような使い方はただの副産物であり、本来はクロージャを渡すことを想定している。</p>
<pre><code class="language-php"># 最も有用な使い方はクロージャを与えた時（有用と言うか、クロージャのために存在していると言っても過言ではない）
$db-&gt;selectTuple([
    'tablename' =&gt; [
        // カラムa, カラムb を自動で取得し、その加算結果を列として取得する（第2引数以降で取得するカラムを指定する）
        'a+b' =&gt; new PhpExpression(function ($a, $b) { return $a + $b; }, 'a', 'b'),
        // なお、クロージャは自動で PhpExpression に変換されるのでこれでも同じ（引数のデフォルト値で取得するカラムを指定する）
        'a*b' =&gt; function ($a = 'a', $b = 'b') { return $a * $b; },
        // 素のクロージャで引数のデフォルト値がない場合、行全体が引数として渡ってくる
        'a-b' =&gt; function ($row) { return $row['a'] - $row['b']; },
        // 素のクロージャで引数のデフォルト値が null の場合、キーをカラム名として使用する
        'a'   =&gt; function ($id = null) { $id * 10; },
    ],
]);
// results:
[
    // 仮に、a:4 b:2 だとしたら下記が結果配列に含まれてくる
    'a+b' =&gt; 6,
    'a*b' =&gt; 8,
    'a-b' =&gt; 2,
    'a'   =&gt; 40,
];
</code></pre>
<p>上記の最後の「引数のデフォルト値が null」について補足すると、この形式は動的な部分が一切ない。つまりただの関数として持ち回すことができる。<br />
よくありそうな処理は組み込みで用意してあるが、 define を使用して登録することもできる。</p>
<pre><code class="language-php"># もち回せる関数の登録と組み込み処理の例
// まず append という名前で処理を登録する
PhpExpression::define('append', function ($column, ...$appendix) {
    return $column . '-' . implode('', $appendix);
});
// 組み込みと登録した append を使用する例
$db-&gt;selectTuple([
    'tablename' =&gt; [
        // PhpExpression::explode は「指定文字列で explode するクロージャ」を返すので、こうするだけでカラム a をカンマでバラすことができる
        'a' =&gt; PhpExpression::explode(','),
        // 上記で登録した append を使う（使い方自体は変わらない）
        'b' =&gt; PhpExpression::append('X', 'Y', 'Z'),
    ],
]);
// results:
[
    // 仮に、a:"x,y,z" b:"hogestring" だとしたら下記が結果配列に含まれてくる
    'a' =&gt; ['x', 'y', 'z'], // カンマでバラされている
    'b' =&gt; 'hogestring-XYZ', // 与えた引数 XYZ が付与されている
];
</code></pre>
<p>ただし、実際のところすごく難解でかつニッチなので、実際のところ</p>
<ul>
<li><code>function ($row) {}</code> 小細工せずに行をまるごと返す形式</li>
<li><code>function ($id = 'id') {}</code> デフォルト値でカラムを指定する形式<br />
程度しか使われないしこれさえ覚えておけば困らない（その場にクロージャで書かれていた方が何をしているか分かりやすい、というメリットもある）。</li>
</ul>
</div>
						</div>
						<div class="attribute">
							<span class="label label-default"></span>
							<span class="label label-default"></span>
						</div>
						<div class="clearfix"></div>
					</li>
                					<li class="structure-item">
						<div class="attribute">
							<span class="label label-danger"></span>
							<span class="label label-warning"></span>
							<span class="label label-info"></span>
							<span class="label label-info"></span>
							<span class="label label-deprecated"></span>
                            			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/SelectOption.php#L5-L72" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            						</div>
						<h4 id="ryunosuke\dbml\Query\Expression\SelectOption" tabindex="-1" class="structure-title ">
							<a href="ryunosuke-dbml-Query-Expression-SelectOption$typespace.html#ryunosuke\dbml\Query\Expression\SelectOption">SelectOption</a>
						</h4>
						<div class="inner-item">
							<div class="description"><p>SELECT オプションクラス</p>
<p>このクラスのインスタンスを select すると、カラムとして追加されるのではなく、 SELECT 句の冒頭にカンマ無しで展開される。<br />
<code>SELECT OPT1 OPT2 column1, column2</code> のような形を実現するためのクラス。</p>
<pre><code class="language-php">$db-&gt;select('tablename.columname')-&gt;addSelectOption(SelectOption::DISTINCT);
// SELECT DISTINCT columnname FROM tablename
</code></pre>
</div>
						</div>
						<div class="attribute">
							<span class="label label-default"></span>
							<span class="label label-default"></span>
						</div>
						<div class="clearfix"></div>
					</li>
                					<li class="structure-item">
						<div class="attribute">
							<span class="label label-danger"></span>
							<span class="label label-warning"></span>
							<span class="label label-info"></span>
							<span class="label label-info"></span>
							<span class="label label-deprecated"></span>
                            			<a href="https://github.com/arima-ryunosuke/dbml/blob/master/src/dbml/Query/Expression/Operator.php#L16-L391" class="source-link glyphicon glyphicon-new-window" target="_blank"></a>
            						</div>
						<h4 id="ryunosuke\dbml\Query\Expression\Operator" tabindex="-1" class="structure-title ">
							<a href="ryunosuke-dbml-Query-Expression-Operator$typespace.html#ryunosuke\dbml\Query\Expression\Operator">Operator</a>
						</h4>
						<div class="inner-item">
							<div class="description"><p>演算子を表すクラス</p>
<p>内部的に使用されるだけで、明示的に使用する箇所はほとんど無い。<br />
ただし、下記の演算子登録を使用する場合は <tag_link data-kind='fqsen' data-type-category='method' data-type-fqsen='ryunosuke\dbml\Query\Expression\Operator::define()' data-type-array='0' data-description='define()'>define()</tag_link> で登録する必要がある。</p>
<p>組み込みの演算子は下記。これらは何もしなくても whereInto で使用することができる。</p>
<table>
<thead>
<tr><th align="left">operator</th><th align="left">result</th><th align="left">説明</th></tr>
</thead>
<tbody>
<tr><td align="left"><code>LIKE</code>, <code>BETWEEN</code>, <code>=</code>, <code>&lt;&gt;</code>, etc...</td><td align="left">略。BETWEEN は値に配列を与える</td><td align="left">大体の RDBMS に備わっている標準的な演算子。想起される通りの動作するので説明は省略。他にも <code>IN</code> や <code>&lt;=&gt;</code> 等がある。</td></tr>
<tr><td align="left"><code>'hoge:[~)' =&gt; [1, 9]</code></td><td align="left"><code>hoge &gt;= 1 AND hoge &lt; 9</code></td><td align="left">範囲指定。 <code>[~]</code> の <code>[]</code> はイコール有り、<code>()</code> はイコール無しを意味する。つまり、 <code>[~]</code> <code>[~)</code> <code>(~]</code> <code>(~)</code> の4つの演算子がある。順に「以上・以下」「以上・小なり」「大なり・以下」「大なり・小なり」を意味する。</td></tr>
<tr><td align="left"><code>'hoge:[~)' =&gt; [1, null]</code></td><td align="left"><code>hoge &gt;= 1</code></td><td align="left">上記と同じ。ただし、バインド値に null を渡すと指定した方の条件が吹き飛ぶ</td></tr>
<tr><td align="left"><code>'hoge:[~)' =&gt; [null, 9]</code></td><td align="left"><code>hoge &lt; 9</code></td><td align="left">上記の後半部分版</td></tr>
<tr><td align="left"><code>'hoge:[~)' =&gt; [null, null]</code></td><td align="left">-</td><td align="left">バインド値に両方 null を渡すと条件自体が吹き飛ぶ</td></tr>
<tr><td align="left"><code>'hoge:LIKE%' =&gt; 'wo%rd'</code></td><td align="left"><code>hoge LIKE 'wo\%rd%'</code></td><td align="left">LIKEエスケープを施した上で右に"%"を付加してLIKEする。他にも <code>%LIKE</code> <code>%LIKE%</code> がある</td></tr>
<tr><td align="left"><code>'hoge:LIKEIN%' =&gt; ['he%lo', 'wo%rd']</code></td><td align="left"><code>hoge LIKE 'he\%lo%' OR hoge LIKE 'wo\%rd%'</code></td><td align="left">上記の配列IN版。構文的には <code>LIKE ANY('str1', 'str2')</code> みたいなもの</td></tr>
<tr><td align="left"><code>'hoge:NULLIN' =&gt; [1, 2, 3, NULL]</code></td><td align="left"><code>hoge IN (1, 2, 3) OR hoge IS NULL</code></td><td align="left">NULL を許容できる IN。 <code>[1, 2, 3, null]</code> などとすると IN(1, 2, 3) or NULL のようになる</td></tr>
</tbody>
</table>
<pre><code class="language-php"># 独自演算子 FISOR を定義する
Operator::define('FISOR', function ($column, $params) {
    $conds = array_fill(0, count($params), "FIND_IN_SET(?, $column)");
    return [implode(' OR ', $conds) =&gt; $params];
});

# すると whereInto の演算子指定で使用できるようになる
$db-&gt;whereInto(['col:FISOR' =&gt; [1, 2]]);
// WHERE FIND_IN_SET(1, col) OR FIND_IN_SET(2, col)
</code></pre>
</div>
						</div>
						<div class="attribute">
							<span class="label label-default"></span>
							<span class="label label-default"></span>
						</div>
						<div class="clearfix"></div>
					</li>
                			</ul>
            
    
    	<div class="attribute">
		<span class="label label-default"></span>
		<span class="label label-default"></span>
	</div>
	<div class="clearfix"></div>
</div>
</body>
</html>
